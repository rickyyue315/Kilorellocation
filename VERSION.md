# 版本更新記錄

## v1.9 (2025-10-01)

### 新增功能
- **簡化雙模式系統**：取消C/D模式的組合，只保留A(保守轉貨)/B(加強轉貨)的雙模式系統
- **優化轉出類型判斷邏輯**：
  - 如果轉出店鋪轉出後, 剩餘庫存不會低過Safety stock, 轉出類型定位為RF過剩轉出
  - 如果轉出店鋪轉出後, 剩餘庫存會低過Safety stock, 轉出類型定位為RF加強轉出
- **優化接收條件**：SaSa Net Stock + Pending Received < Safety Stock，便需要進行調撥接收
- **增強的統計分析**：添加更詳細的轉出類型分析，包括庫存變化情況

### 業務邏輯更新
- **A模式(保守轉貨)**：轉出後剩餘庫存不低於安全庫存，轉出類型為RF過剩轉出
- **B模式(加強轉貨)**：轉出後剩餘庫存可能低於安全庫存，轉出類型為RF加強轉出
- **轉出類型判斷**：根據轉出後剩餘庫存與安全庫存的關係，自動判斷轉出類型
- **接收條件優化**：簡化接收條件，只要總可用庫存低於安全庫存就需要調撥

### 技術更新
- 重構業務邏輯模組，簡化為雙模式系統
- 更新Streamlit界面，移除C/D模式選擇
- 優化圖表顯示，支持RF加強轉出類型
- 更新測試腳本，適應新的雙模式系統

### 修復問題
- 修復轉出類型判斷邏輯
- 改進接收條件判斷
- 優化統計分析功能

## v1.8.1 (2025-10-01)

### 新增功能
- **依賴安裝問題解決**：創建專用依賴安裝腳本
- **數據格式適配**：支持缺少"Article Description"欄位的Excel文件
- **增強錯誤處理**：添加更詳細的錯誤信息和恢復機制

### 技術更新
- 更新requirements.txt，使用兼容的版本範圍
- 增強運行腳本的錯誤處理和恢復機制
- 添加多種依賴安裝解決方案和備選方案
- 更新生成Excel文件名，包含日期信息

### 修復問題
- 修復依賴安裝問題
- 改進文件格式驗證
- 增強錯誤處理和日誌記錄

## v1.8 (2025-10-01)

### 新增功能
- **雙模式(雙組合)系統**：實現A(保守轉貨)/B(加強轉貨) + C(按OM調配)/D(按港澳調配)的組合系統
- **模式選擇界面**：在側邊欄添加模式選擇功能，支持用戶選擇不同的轉貨和調配模式
- **模式說明**：添加各模式的詳細說明，幫助用戶理解不同模式的區別
- **增強的數據驗證**：添加文件格式驗證和RP Type欄位值驗證
- **MOQ欄位支持**：添加對MOQ(最低派貨數量)欄位的處理
- **站點分組功能**：實現按港澳地區的站點分組(HA*/HB*/HC*和HD*)
- **增強的統計分析**：添加涉及產品數量和OM數量的統計
- **可視化圖表**：添加OM Transfer vs Receive Analysis橫條圖
- **更新的Excel輸出**：更新Excel輸出格式，包含Transfer OM和Receive OM欄位

### 業務邏輯更新
- **A模式(保守轉貨)**：RF過剩轉出限制為庫存的20%，最少2件
- **B模式(加強轉貨)**：RF加強轉出限制為庫存的50%，最少2件，基於MOQ+1計算
- **C模式(按OM調配)**：僅允許相同產品編號且OM代號完全匹配的調撥
- **D模式(按港澳調配)**：允許相同產品跨OM調撥，HA*/HB*/HC*可互相互補
- **調貨數量優化**：如果只有1件，嘗試調高到2件（前提是不影響轉出店鋪安全庫存）

### 技術更新
- 添加matplotlib和seaborn依賴，支持數據可視化
- 更新數據處理模組，增強錯誤處理和數據驗證
- 重構業務邏輯模組，支持雙模式系統
- 更新Excel輸出模組，支持新的欄位格式
- 升級Streamlit界面，添加模式選擇和圖表顯示

### 修復問題
- 修復Article欄位格式處理問題
- 改進缺失值和異常值處理邏輯
- 增強質量檢查機制

## v1.7 (2023-09-17)

### 新增功能
- **基礎調貨建議系統**：實現基本的庫存調貨建議功能
- **數據預處理**：支持Excel文件讀取和數據清理
- **轉出/接收規則**：實現ND和RF類型的轉出和接收規則
- **匹配算法**：按優先級進行轉出和接收匹配
- **質量檢查**：確保調貨建議的準確性和合理性
- **Excel導出**：生成包含調貨建議和統計摘要的Excel文件
- **Streamlit界面**：提供用戶友好的Web界面

### 業務邏輯
- **轉出規則**：
  - 優先級1：ND類型轉出（全部庫存）
  - 優先級2：RF類型過剩轉出（庫存充足且非最高銷量）
- **接收規則**：
  - 優先級1：緊急缺貨補貨（無庫存但有銷售記錄）
  - 優先級2：潛在缺貨補貨（庫存不足且為最高銷量）
- **有效銷量計算**：優先使用上月銷量，若為0則使用本月銷量

### 技術實現
- 使用pandas進行數據處理
- 使用openpyxl處理Excel文件
- 使用streamlit構建Web界面
- 使用xlsxwriter生成Excel文件

---

**開發者：Ricky**  
**最後更新：2025-10-01**